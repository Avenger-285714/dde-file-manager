<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- dfmroot.qdoc -->
  <title>DFMRoot Scheme | Deepin File Manager</title>
  <link rel="stylesheet" type="text/css" href="style/online.css" />
</head>
<body>
<div class="header" id="qtdocheader">
    <div class="main">
    <div class="main-rounded">
        <div class="navigationbar">
        <ul>
<li>DFMRoot Scheme</li>
    </ul>
    </div>
</div>
<div class="content">
<div class="line">
<div class="content mainContent">
<div class="sidebar">
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#scheme-structure">Scheme Structure</a></li>
<li class="level2"><a href="#sample-urls">Sample URLs</a></li>
<li class="level1"><a href="#fileinfo-usage">FileInfo Usage</a></li>
<li class="level1"><a href="#controller-usage">Controller Usage</a></li>
<li class="level2"><a href="#re-labelling-a-filesystem">Re-labelling a filesystem</a></li>
<li class="level2"><a href="#if-you-want-to-mount-unmount-a-filesystem">If you want to mount/unmount a filesystem..&#x2e;</a></li>
<li class="level1"><a href="#dodging-slippery-behaviors-of-gio-gvfs">Dodging slippery behaviors of Gio/Gvfs</a></li>
</ul>
</div>
<div class="sidebar-content" id="sidebar-content"></div></div>
<div class="context">
<h1 class="title">DFMRoot Scheme</h1>
<span class="subtitle"></span>
<!-- $$$dfmroot-scheme.html-description -->
<div class="descr"> <a name="details"></a>
<p>The DFMRoot scheme is primarily designed to be used by the new Computer View. It is essentially an enhanced version of the computer scheme found in Gvfs.</p>
<p>The scheme deals with 3 types of locations: user directories, local disks / loop devices handled by UDisks2, and network locations mounted by Gvfs.</p>
<a name="scheme-structure"></a>
<h2 id="scheme-structure">Scheme Structure</h2>
<p>All locations handled by DFMRoot are virtual entries located directly under the root directory. They are distinguished by different suffices.</p>
<ul>
<li>suffix &quot;userdir&quot;<p>Entries with this suffix have one of the following basenames: <code>desktop</code>, <code>videos</code>, <code>music</code>, <code>pictures</code>, <code>documents</code>, <code>downloads</code></p>
<p>They all refer to the corresponding directory in the current user's home directory. If a location is explicitly disabled by the user-dirs.dir file, it will be treated as if it doesn't exist.</p>
</li>
<li>suffix &quot;localdisk&quot;<p>Entries with this suffix has the name of a block device as its basename.</p>
<p>Note: for encrypted block devices, the cleartext device is never be used to construct the URL of this scheme. The controller doesn't acknowledge the existence of such devices either. In such case, block device containing the encrypted data should be used instead.</p>
</li>
<li>suffix &quot;gvfsmp&quot;<p>Entires with this suffix has percent-encoded path of mount point as its basename. This could be confusing: path of gvfs-managed mount point may already contain percent-encoded or sometimes even double percent-encoded components. In any case, a single decode pass should always result in the correct mount point path. Please note that this scheme only handles GVolume that has a mount point, i.e&#x2e; already mounted.</p>
</li>
</ul>
<a name="sample-urls"></a>
<h3 >Sample URLs</h3>
<ul>
<li>dfmroot:///desktop.userdir</li>
<li>dfmroot:///sda2.localdisk</li>
<li>dfmroot:///mmcblk0p1.localdisk</li>
<li>dfmroot:///nvme0n1p3.localdisk</li>
<li>dfmroot:///sr0.localdisk</li>
<li>dfmroot:///%2Frun%2Fuser%2F1000%2Fgvfs%2Fsmb-share%3Aserver%3D10.0&#x2e;12.150%2Cshare%3Dshare.gvfsmp</li>
<li>dfmroot:///%2Frun%2Fuser%2F1000%2Fgvfs%2Farchive%3Ahost%3Dfile%25253A%25252F%25252F%25252Fhome%25252Fc%25252Fdevel%25252Ftest.iso.gvfsmp</li>
</ul>
<a name="fileinfo-usage"></a>
<h2 id="fileinfo-usage">FileInfo Usage</h2>
<p>Entries using this scheme can always be redirected. Use <code>redirectedFileUrl()</code> to obtain its location in the local file hierarchy.</p>
<p>You can determine the type of an entry by calling <code>fileType()</code>. The returned value has the type <code>DFMRootFileInfo::ItemType</code>.</p>
<p>Extra properties returned for FileInfo of this type:</p>
<div class="table"><table class="generic">
 <thead><tr class="qt-style"><th >prop/suffix</th><th >gvfsmp</th><th >localdisk</th></tr></thead>
<tr valign="top" class="odd"><td >fsUsed</td><td  colspan="2" rowspan=" 1">(quint64) Used size of the volume, in bytes.</td></tr>
<tr valign="top" class="even"><td >fsSize</td><td  colspan="2" rowspan=" 1">(quint64) Total size of the volume, in bytes.</td></tr>
<tr valign="top" class="odd"><td >fsType</td><td  colspan="2" rowspan=" 1">(QString) Filesystem name of the volume.</td></tr>
<tr valign="top" class="even"><td >rooturi</td><td >(QString) Root URI of the mount, e.g&#x2e; smb://127.0&#x2e;0&#x2e;1/share</td><td >-</td></tr>
<tr valign="top" class="odd"><td >encrypted</td><td >-</td><td >(bool) whether the block device is encrypted</td></tr>
<tr valign="top" class="even"><td >unlocked</td><td >-</td><td >(bool) false if the device is encrypted and locked. True otherwise.</td></tr>
<tr valign="top" class="odd"><td >udisksblk</td><td >-</td><td >(QString) DBus path of the block device. If the device is encrypted and unlocked, this will refer to the cleartext device instead.</td></tr>
<tr valign="top" class="even"><td >mounted</td><td  colspan="2" rowspan=" 1">(bool) Whether the volume is mounted.</td></tr>
</table></div>
<p>User directories do not have any extra properties.</p>
<a name="controller-usage"></a>
<h2 id="controller-usage">Controller Usage</h2>
<a name="re-labelling-a-filesystem"></a>
<h3 >Re-labelling a filesystem</h3>
<p>Only items controlled by udisks can be re-labeled. Call renameFile with an event with following parameters to change the label of a filesystem:</p>
<ul>
<li>fromUrl: the URL of the item to be re-labeled.</li>
<li>toUrl: a URL whose path section is the desired filesystem label.</li>
</ul>
<p>The user will be prompted for their (or the administrator's) password if necessary.</p>
<a name="if-you-want-to-mount-unmount-a-filesystem"></a>
<h3 >If you want to mount/unmount a filesystem..&#x2e;</h3>
<p>You have to make calls to udisks manually, or check out if anything in AppController satisfy your needs.</p>
<a name="dodging-slippery-behaviors-of-gio-gvfs"></a>
<h2 id="dodging-slippery-behaviors-of-gio-gvfs">Dodging slippery behaviors of Gio/Gvfs</h2>
<ul>
<li>Gvfs volumes that has one of the following URI schemes are automatically mounted when detected (while fetching content of DFMRoot or have a file watcher actively watching its changes): mtp, afc, gphoto2.</li>
<li>'GMount's of the following class are ignored: GUnixMount.</li>
<li>'GMount's originated from a udisks mount are ignored.</li>
<li>'GMount's that correspond to a blank writable optical disc are ignored.</li>
</ul>
</div>
<!-- @@@dfmroot-scheme.html -->
</div>
</div>
</div>
</div>
</div>
</body>
</html>
